            <InputDialog
                open={reportOpen}
                title="Mesajı raporla"
                description="Bu mesajı raporlama nedeninizi belirtin."
                placeholder="Raporlama nedeni..."
                confirmText={reporting ? 'Gönderiliyor...' : 'Raporla'}
                cancelText="İptal"
                required
                onClose={() => {
                    if (reporting) return
                    setReportOpen(false)
                    setReportTarget(null)
                }}
                onConfirm={handleConfirmReport}
            />

            {stickersOpen && (
                <div className="fixed inset-0 z-[70] bg-black/60 flex items-end md:items-center justify-center p-4">
                    <div className="bg-[#0b0f14] border border-white/10 rounded-2xl w-full max-w-md p-4 space-y-3">
                        <div className="flex items-center justify-between">
                            <div className="font-semibold">Sticker gönder</div>
                            <Button
                                type="button"
                                variant="ghost"
                                onClick={() => setStickersOpen(false)}
                                className="h-auto px-0 text-xs text-gray-400 hover:text-[var(--foreground)]"
                            >
                                Kapat
                            </Button>
                        </div>
                        <div className="grid grid-cols-3 gap-2 max-h-[60vh] overflow-y-auto p-1">
                            {displayStickers.map((s) => (
                                <Button
                                    key={s.id}
                                    type="button"
                                    variant="secondary"
                                    onClick={async () => {
                                        if (!user) return
                                        const inserted = await sendStickerMessage(matchId, user.id, s.id, s.image_url)
                                        if (inserted) appendMessage(inserted as Message)
                                        setStickersOpen(false)
                                    }}
                                    className="w-full bg-white/5 rounded-xl p-3 hover:bg-white/10"
                                >
                                    <div className="relative w-14 h-14 rounded-xl overflow-hidden">
                                        <Image src={s.image_url || ''} alt={s.name} fill className="object-cover" />
                                    </div>
                                </Button>
                            ))}
                            {displayStickers.length === 0 && (
                                <div className="text-xs text-gray-400 col-span-3">Sticker bulunamadı.</div>
                            )}
                        </div>
                    </div>
                </div>
            )}

            {/* Agora Call Overlay - Appears when call is active */}
            {activeCall && otherUser && (
                <AgoraCallOverlay 
                    callSession={activeCall}
                    otherUser={otherUser}
                    onEnd={async () => {
                        try {
                            await respondCall(activeCall.id, 'end')
                            setActiveCall(null)
                        } catch (err) {
                            console.error(err)
                            setActiveCall(null) // Force close anyway
                        }
                    }}
                />
            )}
        </div>
    )
}
